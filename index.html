<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="robots" content="noindex, nofollow">
        <title>Check-in Instructions</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link
            rel="stylesheet"
            href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

        <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    }

    #map {
      height: 100vh;
      width: 100vw;
    }

    /* Top instruction bar */
    .instruction-bar {
      position: fixed;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      width: calc(100% - 20px);
      max-width: 520px;
      background: white;
      z-index: 1000;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      padding: 12px 16px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .nav-btn {
      background: #2563eb;
      color: white;
      border: none;
      border-radius: 50%;
      width: 36px;
      height: 36px;
      font-size: 18px;
      cursor: pointer;
      flex-shrink: 0;
    }

    .nav-btn:disabled {
      background: #cbd5f5;
      cursor: not-allowed;
    }

    .step-text {
      flex: 1;
      font-size: 14px;
    }

    .step-text strong {
      display: block;
      font-size: 15px;
    }
  </style>
    </head>

    <body>

        <div class="instruction-bar">
            <button class="nav-btn" id="prevBtn" onclick="prevStep()">‹</button>
            <div class="step-text" id="stepText"></div>
            <button class="nav-btn" id="nextBtn" onclick="nextStep()">›</button>
        </div>

        <div id="map"></div>

        <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

        <script>
  const map = L.map('map',{zoomControl: false}).setView([-33.8768, 151.2054], 17);

  L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
	attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
	subdomains: 'abcd',
	maxZoom: 20,
    attribution: '&copy; OpenStreetMap'
  }).addTo(map);
    L.control.zoom({
    position: 'bottomright' // <-- this moves zoom buttons
    }).addTo(map);
  const sunTower = L.marker([-33.87732111531777, 151.20569434195536])
    .bindPopup(`Sun Tower Entrance <img src="Sun Tower.png" style="width:300px; border-radius:8px; margin-top:8px;"">`)
    .addTo(map);

  const lockbox = L.marker([-33.87703364976371, 151.20497041045243])
    .bindPopup(`Lockbox – Eagar Street<br>Lockbox Label: 4H     
    <img src="Eagar Street.png" alt="The Summit Apartments" style="width:300px; border-radius:8px; margin-top:8px;">
`    )
    .addTo(map);

  const property = L.marker([-33.8765827082173, 151.20575763876224])
    .bindPopup(`The Summit Apartments 
    <img src="Summit Apartments.png" alt="The Summit Apartments" style="width:300px; border-radius:8px; margin-top:8px;">
    `)
    .addTo(map);

  const route1 = L.polyline([
    [-33.87732111531777, 151.20569434195536],
    [-33.87703364976371, 151.20497041045243]
  ], { color: '#2563eb', weight: 5 });

  const route2 = L.polyline([
    [-33.87703364976371, 151.20497041045243],
    [-33.87732111531777, 151.20569434195536]
  ], { color: '#9333ea', weight: 5 });

  const route3 = L.polyline([
    [-33.87732111531777, 151.20569434195536],
    [-33.8765827082173, 151.20575763876224]
  ], { color: '#16a34a', weight: 5 });

  const steps = [
    {
      title: "Step 1 – Approach Sun Tower on 591 George Street",
      text: "Walk through the mall towards the back onto Eagar Street.",
      action: () => {
        clearRoutes();
        route1.addTo(map);
        map.setView([-33.87715, 151.20525], 18);
        openPopupLower(sunTower);
      }
    },
    {
      title: "Step 2 – Collect keys",
      text: "1) Find lockbox labelled 4H on Eagar Street. <br> 2) Use the lockbox code provided in your message to unlock. <br> 3) You should find 2 sets of key cards, 2 sets of keys and a garage remote",
      action: () => {
        clearRoutes();
        route1.addTo(map);
        map.setView([-33.87703, 151.20497], 18);
        openPopupLower(lockbox)
      }
    },
    {
      title: "Step 3 – Return to George Street",
      text: "Walk back the same way you came.",
      action: () => {
        clearRoutes();
        route2.addTo(map);
        map.setView([-33.87715, 151.20525], 18);
        // Change the lockbox popup content dynamically
        lockbox.setPopupContent(`
        <strong>Walk back to George Street</strong><br>
        <img src="BackToGeorge.png" style="width:300px; border-radius:8px; margin-top:8px;">
        `);
      }
    },
    {
      title: "Step 4 – Go to apartment",
      text: "Walk to The Summit Apartments located on 569 George Street",
      action: () => {
        clearRoutes();
        route3.addTo(map);
        map.setView([-33.87670, 151.20580], 18);
        openPopupLower(property);
      }
    }
  ];

function openPopupLower(marker, zoom = 18, offsetY = 100) {
  // Get marker position
  const latlng = marker.getLatLng();

  // Convert offset in pixels to LatLng
  const point = map.latLngToContainerPoint(latlng);       // marker → screen pixels
  const newPoint = L.point(point.x, point.y - offsetY);  // move upward in pixels
  const newLatLng = map.containerPointToLatLng(newPoint); // convert back to LatLng

  // Fly to new LatLng
  map.flyTo(newLatLng, zoom);

  // Open popup
  marker.openPopup();
}

  let currentStep = 0;


  function renderStep() {
    const step = steps[currentStep];
    document.getElementById("stepText").innerHTML =
      `<strong>${step.title}</strong>${step.text}`;

    document.getElementById("prevBtn").disabled = currentStep === 0;
    document.getElementById("nextBtn").disabled = currentStep === steps.length - 1;

    step.action();
  }

  function nextStep() {
    if (currentStep < steps.length - 1) {
      currentStep++;
      renderStep();
    }
  }

  function prevStep() {
    if (currentStep > 0) {
      currentStep--;
      renderStep();
    }
  }

  function clearRoutes() {
    map.eachLayer(layer => {
      if (layer instanceof L.Polyline) {
        map.removeLayer(layer);
      }
    });
  }

  // Init
  renderStep();
</script>

    </body>
</html>
